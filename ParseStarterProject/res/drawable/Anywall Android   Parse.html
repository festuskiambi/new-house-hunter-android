<!DOCTYPE html>
<!-- saved from url=(0047)https://www.parse.com/tutorials/anywall-android -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><script type="text/javascript" async="" src="./Anywall Android   Parse_files/conversion_async.js"></script><script type="text/javascript" async="" src="./Anywall Android   Parse_files/munchkin.js"></script><script type="text/javascript" async="" src="./Anywall Android   Parse_files/munchkin.js"></script><script async="" src="./Anywall Android   Parse_files/fbds.js"></script><script async="" src="./Anywall Android   Parse_files/gtm.js"></script><script type="text/javascript" async="" src="./Anywall Android   Parse_files/52373e831aa4c02794000069.js"></script><script type="text/javascript" async="" src="./Anywall Android   Parse_files/ga.js"></script>
    <title>Anywall Android | Parse</title>
    <link href="./Anywall Android   Parse_files/css" rel="stylesheet" type="text/css">
    <link href="./Anywall Android   Parse_files/css(1)" rel="stylesheet" type="text/css">

    
        <link rel="apple-touch-icon" sizes="57x57" href="https://www.parse.com/apple-touch-icon-57x57.png">
        <link rel="apple-touch-icon" sizes="114x114" href="https://www.parse.com/apple-touch-icon-114x114.png">
        <link rel="apple-touch-icon" sizes="72x72" href="https://www.parse.com/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="144x144" href="https://www.parse.com/apple-touch-icon-144x144.png">
        <link rel="apple-touch-icon" sizes="60x60" href="https://www.parse.com/apple-touch-icon-60x60.png">
        <link rel="apple-touch-icon" sizes="120x120" href="https://www.parse.com/apple-touch-icon-120x120.png">
        <link rel="apple-touch-icon" sizes="76x76" href="https://www.parse.com/apple-touch-icon-76x76.png">
        <link rel="apple-touch-icon" sizes="152x152" href="https://www.parse.com/apple-touch-icon-152x152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="https://www.parse.com/apple-touch-icon-180x180.png">
        <meta name="apple-mobile-web-app-title" content="Parse">
        <link rel="icon" type="image/png" href="https://www.parse.com/favicon-192x192.png" sizes="192x192">
        <link rel="icon" type="image/png" href="https://www.parse.com/favicon-160x160.png" sizes="160x160">
        <link rel="icon" type="image/png" href="https://www.parse.com/favicon-96x96.png" sizes="96x96">
        <link rel="icon" type="image/png" href="https://www.parse.com/favicon-16x16.png" sizes="16x16">
        <link rel="icon" type="image/png" href="https://www.parse.com/favicon-32x32.png" sizes="32x32">
        <meta name="msapplication-TileColor" content="#5298fc">
        <meta name="msapplication-TileImage" content="/mstile-144x144.png">
        <meta name="application-name" content="Parse">
    
    <link href="./Anywall Android   Parse_files/main.css" media="screen" rel="stylesheet" type="text/css">
    <!--[if lt IE 8]>
        <link rel="stylesheet" type="text/css" href="/stylesheets/ie7.css" />
    <![endif]-->
    <!--[if IE 8]>
        <link rel="stylesheet" type="text/css" href="/stylesheets/ie8.css" />
    <![endif]-->
    <!--[if lt IE 10]>
        <link rel="stylesheet" type="text/css" href="/stylesheets/ie89.css" />
    <![endif]-->
    <script>if(Function('/*@cc_on return document.documentMode===10@*/')()){document.documentElement.className+=' ie10';}</script>
    
    <script src="./Anywall Android   Parse_files/main.js" type="text/javascript"></script><style type="text/css"></style>
    
    <meta name="csrf-param" content="authenticity_token">
<meta name="csrf-token" content="bm76myhDtSzEoLmcY+tcviXy1lon7EIAmDwYU+CW6Hc=">
    <meta name="description" content="Focus on creating unique &amp; engaging apps on any platform. We take care of everything else your app needs, from the core of your app to analytics and push notifications.">
    <meta name="keywords" content="backend, mobile, development, server, code">
    <meta property="fb:app_id" content="361736430535656"> 
    <meta property="og:type" content="website"> 
    <meta property="og:title" content="Parse"> 
    <meta property="og:image" content="http://parse.com/images/og/default.jpg"> 
    <meta property="og:description" content="Focus on creating unique &amp; engaging apps on any platform. We take care of everything else your app needs, from the core of your app to analytics and push notifications."> 
    <meta property="og:url" content="https://parse.com/tutorials/anywall-android">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    

    <script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script>
<script type="text/javascript" async="" src="https://pixel-geo.prfct.co/tagjs?a_id=16580&source=js_tag"></script><img src="https://pixel-geo.prfct.co/seg/?add=1016248&source=js_tag&a_id=16580" width="1" height="1" border="0"><img src="https://secure.adnxs.com/seg?t=2&add=1016248" width="1" height="1" border="0"></head>


    <body class="p_tutorials p_tutorials_show  user_logged_in">
          <ul class="banner_nag">
  </ul>


        <div id="header">
  <div class="inner">
      <div class="login_container logged_in">
    <iframe class="account_iframe" scrolling="no" src="./Anywall Android   Parse_files/dashboard_link.html"></iframe>
</div>



    <a class="logo" href="https://www.parse.com/"><img width="100" alt="Parse" src="./Anywall Android   Parse_files/parse-logo.png"></a>

    <ul class="main_menu">
      <li><a href="https://www.parse.com/products"><span class="menu_inner">Products</span></a></li>
      <li><a href="https://www.parse.com/customers"><span class="menu_inner">Customers</span></a></li>
      <li><a href="https://www.parse.com/plans"><span class="menu_inner">Pricing</span></a></li>
      <li><a href="https://www.parse.com/docs"><span class="menu_inner">Docs</span></a></li>
      <li><a href="https://www.parse.com/help"><span class="menu_inner">Help</span></a></li>                  
      <li><a href="http://blog.parse.com/"><span class="menu_inner">Blog</span></a></li>
    </ul>
    <div class="clear"></div>
  </div>
</div>


        <div class="container">
            
            
            
<div class="top_section">
  
  
  <h1>
      <div class="icon"><img alt="Icon144" src="./Anywall Android   Parse_files/Icon144.png"><br></div>
    Anywall Android
  </h1>

    <h3>
      <p>Explore the use of ParseGeoPoint, ParseUser and ParseConfig in a real application. Anywall is a geocaching app with a social twist. You'll learn everything from implementing a basic user management workflow to tracking GPS location with the Google Maps AP</p>

    </h3>
  
  <div class="tags">
      <div>Anywall</div>
      <div> ParseUser</div>
      <div> ParseQueryAdapter</div>
      <div> ParseQuery</div>
      <div> ParseGeoPoint</div>
      <div> ParseConfig</div>
  </div>

    <div class="actions">
      <p>Download code for this tutorial:</p>
        <a href="https://github.com/ParsePlatform/AnyWall/zipball/master" class="getAppButton">.zip File</a>
      
        <a href="https://github.com/ParsePlatform/AnyWall/tree/master/AnyWall-android" class="getCodeButton">GitHub</a>
    </div>
</div>

<div class="body">

    <p>Anywall is a geocaching application that allows users to share messages by placing them in real world locations. The application is available on Google Play, and is meant to give you an overview of a real app that uses Parse as a backend. In this tutorial, we'll not only look at all of the Parse functionality used, but also many concepts surrounding the uses of Parse.</p>

<p>This tutorial is divided into several parts, each focusing on a different aspect of Anywall. Feel free to read them in any order, but we recommend that you download the source code and refer to it while reading. Some parts of the code were omitted or changed in this tutorial in order to keep it clear and concise, so you may find it useful to keep the full version close at hand.</p>

<p><a href="https://www.parse.com/tutorials/anywall-android#1-overview"><strong>1. Anywall Overview</strong></a><br>
Get familiar with Anywall's architecture. This section provides an overview of the various classes that make up Anywall.</p>

<p><a href="https://www.parse.com/tutorials/anywall-android#2-manage-users"><strong>2. Manage Users</strong></a><br>
Learn how to create a user login and registration workflow from the user interface to the <code>ParseUser</code> request. This section explores the workings of Anywall's user management and shows you how to create a similar workflow in your own apps.</p>

<p><a href="https://www.parse.com/tutorials/anywall-android#3-add-new-posts"><strong>3. Add New Posts</strong></a><br>
Learn how to create to <code>ParseObject</code>s with <code>ParseGeoPoint</code>s. This section explores the code behind the core of Anywall, adding new wall posts.</p>

<p><a href="https://www.parse.com/tutorials/anywall-android#4-view-posts"><strong>4. View Posts</strong></a><br>
Learn how to make Parse queries and display wall posts both on a map in in a list view using <code>ParseQueryAdapter</code>. This section also covers the user's search preferences.</p>

<p><a href="https://www.parse.com/tutorials/anywall-android#5-user-location"><strong>5. Track a User's Location</strong></a><br>
Learn how to integrate the Google Play services Maps API into Anywall. This section explores how the Google's Location Services API can be used to track a user's location.</p>

<p><a href="https://www.parse.com/tutorials/anywall-android#6-configuring-settings"><strong>6. Remote Configuration</strong></a><br>
Learn how to remotely manage app settings using <code>ParseConfig</code>. This section will show you how to do this by configuring two settings used in Anywall: the search radius options and the maximum character count for newly created wall posts.</p>

<p><a name="1-overview"></a></p>

<h1>1. Anywall Overview</h1>

<div style="float:right">
<img src="https://github.com/caabernathy/images/raw/master/anywall/main.png" alt="Main" height="320" align="right" style="padding:0px 10px 10px 10px; border-radius: 5px;">
<p style="text-align:center;margin:0px"><span style="color:#777;font-family:Verdana;font-size:12px;">The finished Anywall app</span></p></div>


<p>In Anywall, users log in and are able to see the closest posts both on a map and in a list. To view the content of a particular post, a user must be within a certain radius from the location it was dropped. Users can modify their search radius preferences that's used to retrieve the content. In addition to viewing posts, users can create posts that are then made visible to other nearby users.</p>

<p>Anywall contains five main activities: <code>SignUpActivity</code> handles the sign up flow, <code>LoginActivity</code> handles the log in flow, <code>MainActivity</code> handles the display of the map and table content, <code>PostActivity</code> handles the creation of new posts, and <code>SettingsActivity</code> handles the search radius customization as well as the log out flow.</p>

<p>In addition to these activities, the app contains the following classes:</p>

<ul>
<li><code>Application</code>: initializes the Parse app settings and manages the search radius preferences.</li>
<li><code>WelcomeActivity</code>: displays the sign up or log in options.</li>
<li><code>DispatchActivity</code>: handles starting the logged in activity, <code>MainActivity</code>, or logged out activity, <code>WelcomeActivity</code>. This activity is the main entry point for the app.</li>
<li><code>AnywallPost</code>: data model that represents a post <code>ParseObject</code>.</li>
<li><code>ConfigHelper</code>: manages remote app configuration using <code>ParseConfig</code>.</li>
</ul>


<p><a name="2-manage-users"></a></p>

<h1>2. Manage Users</h1>

<p>The notion of users is at the core of social applications like Anywall. Using the <code>ParseUser</code> object makes it much easier to manage users, but the client-side workflow surrounding registration and login can be a challenge. This section of the tutorial will shed some light on good practices for implementing the user management workflow and will help you avoid some of the common pitfalls. We'll take a look at the code needed to create new users and log in using the <code>ParseUser</code> object, and we'll look at how we can take advantage of the automatic caching capabilities of the <code>ParseUser</code> object. We'll finish off with the code that logs out users.</p>

<p><code>SignUpActivity</code> and <code>LoginActivity</code> handle registering and logging in users respectively. They are very similar in functionality and we'll start off by looking at the sign up flow in detail, then discuss the differences found in the log in implementation.</p>

<h2>2.1 Sign up flow</h2>

<p>As part of the sign up process, users must select a unique username and supply a password and confirmation password. To get this information, we use <code>EditText</code> widgets that are defined in the <code>activity_signup.xml</code> layout. We retrieve the widgets in the <code>onCreate</code> method of <code>SignUpActivity</code> to begin our sign up flow setup:</p>

<div class="code parseTheme"><div><div id="highlighter_566085" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">usernameEditText = (EditText) findViewById(R.id.username_edit_text);</code></div><div class="line number2 index1 alt1"><code class="java plain">passwordEditText = (EditText) findViewById(R.id.password_edit_text);</code></div><div class="line number3 index2 alt2"><code class="java plain">passwordAgainEditText = (EditText) findViewById(R.id.password_again_edit_text);</code></div></div></td></tr></tbody></table></div></div></div>


<p>Since these fields are required entries for registration, it's a good practice to validate them before we send the data to Parse. This avoids a roundtrip to Parse if we can catch errors on the client side. Our approach will be to validate the form fields when the user clicks the submit button:</p>

<div class="code parseTheme"><div><div id="highlighter_283611" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">Button mActionButton = (Button) findViewById(R.id.action_button);</code></div><div class="line number2 index1 alt1"><code class="java plain">mActionButton.setOnClickListener(</code><code class="java keyword">new</code> <code class="java plain">View.OnClickListener() {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onClick(View view) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">signup();</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}&nbsp;&nbsp; </code></div><div class="line number6 index5 alt1"><code class="java plain">});</code></div></div></td></tr></tbody></table></div></div></div>


<p>In the code above, an <code>OnClickListener</code> handler is attached to the submit button that's identified by the <code>action_button</code> resource. This in turn calls the private <code>signup</code> method where we basically first check that the fields contain text and that the password fields match:</p>

<div class="code parseTheme"><div><div id="highlighter_461102" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">signup() {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">String username = usernameEditText.getText().toString().trim();</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">String password = passwordEditText.getText().toString().trim();</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">String passwordAgain = passwordAgainEditText.getText().toString().trim();</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">boolean</code> <code class="java plain">validationError = </code><code class="java keyword">false</code><code class="java plain">;</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">StringBuilder validationErrorMessage = </code><code class="java keyword">new</code> <code class="java plain">StringBuilder(getString(R.string.error_intro));</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(username.length() == </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">validationError = </code><code class="java keyword">true</code><code class="java plain">;</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">validationErrorMessage.append(getString(R.string.error_blank_username));</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number13 index12 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>We check for a blank username and if it's blank, the <code>validationErrorMessage</code> variable is appended with the appropriate error message  and the <code>validationError</code> flag is set. Similarly, the password and confirmation fields are validated to make sure they're not blank and that they match:</p>

<div class="code parseTheme"><div><div id="highlighter_532306" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">signup() {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(password.length() == </code><code class="java value">0</code><code class="java plain">) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(validationError) {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">validationErrorMessage.append(getString(R.string.error_join));</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">validationError = </code><code class="java keyword">true</code><code class="java plain">;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">validationErrorMessage.append(getString(R.string.error_blank_password));</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!password.equals(passwordAgain)) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(validationError) {</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">validationErrorMessage.append(getString(R.string.error_join));</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">validationError = </code><code class="java keyword">true</code><code class="java plain">;</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">validationErrorMessage.append(getString(R.string.error_mismatched_passwords));</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">validationErrorMessage.append(getString(R.string.error_end));</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number19 index18 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>The validation logic continues to append <code>validationErrorMessage</code> with the appropriate error strings as well as set <code>validationError</code> as errors are detected. When the validations are complete, a check is made for the error flag and a <code>Toast</code> displayed with the combined error message:</p>

<div class="code parseTheme"><div><div id="highlighter_547361" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">signup() {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(validationError) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Toast.makeText(SignUpActivity.</code><code class="java keyword">this</code><code class="java plain">, validationErrorMessage.toString(), Toast.LENGTH_LONG)</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.show();</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number9 index8 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>The <code>signup</code> method also returns to stop the registration flow if there is an error. If there are no validation errors then we are ready to register the user. This involves making a network request when calling the Parse signup API. Since this may take awhile we start a progress dialog before making the call and dismiss it later on when we get a server response:</p>

<div class="code parseTheme"><div><div id="highlighter_831290" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">signup() {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// Set up and start a progress dialog</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">... </code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// Set up a new Parse user</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ParseUser user = </code><code class="java keyword">new</code> <code class="java plain">ParseUser();</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">user.setUsername(username);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">user.setPassword(password);</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// Call the Parse signup method</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">user.signUpInBackground(</code><code class="java keyword">new</code> <code class="java plain">SignUpCallback() { </code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">done(ParseException e) { </code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Handle the response</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">});</code></div><div class="line number16 index15 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>The <code>signUpInBackground</code> method on a <code>ParseUser</code> instance is used to register the user and handle the callback response. We use the asynchronous signup method to avoid blocking the UI thread that's displaying the progress dialog. The signup response is handled by first dismissing the dialog then checking for any errors:</p>

<div class="code parseTheme"><div><div id="highlighter_193336" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java color1">@Override</code></div><div class="line number2 index1 alt1"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">done(ParseException e) {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// Dismiss the dialog</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(e != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Show the error message</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Toast.makeText(SignUpActivity.</code><code class="java keyword">this</code><code class="java plain">, e.getMessage(), </code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Toast.LENGTH_LONG).show();</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Start an intent for the dispatch activity</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Intent intent = </code><code class="java keyword">new</code> <code class="java plain">Intent(SignUpActivity.</code><code class="java keyword">this</code><code class="java plain">, DispatchActivity.</code><code class="java keyword">class</code><code class="java plain">);</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | </code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Intent.FLAG_ACTIVITY_NEW_TASK);</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">startActivity(intent);</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number16 index15 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>A signup error is displayed to the user in a <code>Toast</code>. When we've successfully signed up a new user, we'd like to take them to the logged in view. To do this, we start an intent for <code>DispatchActivity</code> that checks for a valid <code>ParseUser</code> then routes the user to <code>MainActivity</code>.</p>

<h2>2.2 Log in flow</h2>

<p><code>LoginActivity</code> handles the log in flow and has many similarities with the sign up flow. As such, we'll focus on the key differences. The layout for <code>LoginActivity</code> doesn't contain a confirmation password field. There's no validation logic required for password field matches. Lastly, when the submit button is clicked and the validation checks pass, the <code>logInInBackground</code> method is called to log in the user and handle the response:</p>

<div class="code parseTheme"><div><div id="highlighter_948004" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">ParseUser.logInInBackground(usernameEditText.getText().toString(), passwordEditText.getText()</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">.toString(), </code><code class="java keyword">new</code> <code class="java plain">LogInCallback() {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">done(ParseUser user, ParseException e) {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Handle the response</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number7 index6 alt2"><code class="java plain">});</code></div></div></td></tr></tbody></table></div></div></div>


<p></p>

<p>We handle the response by showing an alert if there's an error or starting an intent for <code>DispatchActivity</code> if login completes successfully. <code>DispatchActivity</code> takes care of routing the user to <code>MainActivity</code> if there's a valid user session.</p>

<h2>2.3 Log out flow</h2>

<p>As part of user management, we allow Anywall users to log out from the app. <code>SettingsActivity</code> manages this flow and is accessible via the options menu in <code>MainActivity</code>. A <code>Button</code> widget is defined in the <code>SettingsActivity</code> layout. We then attach the logout logic to the button's <code>OnClickListener</code> handler in the <code>onCreate</code> method:</p>

<div class="code parseTheme"><div><div id="highlighter_457968" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">((Button) findViewById(R.id.logout_button)).setOnClickListener(</code><code class="java keyword">new</code> <code class="java plain">OnClickListener() {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onClick(View v) {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ParseUser.logOut();</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Intent intent = </code><code class="java keyword">new</code> <code class="java plain">Intent(SettingsActivity.</code><code class="java keyword">this</code><code class="java plain">, DispatchActivity.</code><code class="java keyword">class</code><code class="java plain">);</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">intent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TASK | Intent.FLAG_ACTIVITY_NEW_TASK);</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">startActivity(intent);</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number8 index7 alt1"><code class="java plain">});</code></div></div></td></tr></tbody></table></div></div></div>


<p>The code calls <code>logOut()</code> on <code>ParseUser</code> then starts an intent for <code>DispatchActivity</code> which is the main entry point for Anywall. At this point, the user's session is invalidated and they are redirected to <code>WelcomeActivity</code>.</p>

<h2>2.4 Keeping the user logged-in</h2>

<p>The last piece of the user management puzzle is caching. It would be frustrating for a user to log in every time they open Anywall. That is why Parse automatically caches the <code>ParseUser</code> object when a user logs in. The main entry point for the app, <code>DispatchActivity</code> checks the cache for a user and if found, jumps to the main logged-in view:</p>

<div class="code parseTheme"><div><div id="highlighter_316323" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">if</code> <code class="java plain">(ParseUser.getCurrentUser() != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// Start an intent for the logged in activity</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">startActivity(</code><code class="java keyword">new</code> <code class="java plain">Intent(</code><code class="java keyword">this</code><code class="java plain">, MainActivity.</code><code class="java keyword">class</code><code class="java plain">));</code></div><div class="line number4 index3 alt1"><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// Start and intent for the logged out activity</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">startActivity(</code><code class="java keyword">new</code> <code class="java plain">Intent(</code><code class="java keyword">this</code><code class="java plain">, WelcomeActivity.</code><code class="java keyword">class</code><code class="java plain">));</code></div><div class="line number7 index6 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>We start by accessing the cached user via the <code>getCurrentUser</code> method on <code>ParseUser</code>. If this returns a non null value, then an intent for <code>MainActivity</code> is started to show the logged-in view. If no cached user is found, an intent for <code>WelcomeActivity</code> is started to display the sign up or login options.</p>

<p><a name="3-add-new-posts"></a></p>

<h1>3. Add New Posts</h1>

<p>Now that we have a good grasp on the inner workings of Anywall's user management, we can dive into the core of the app: the <code>ParseGeoPoint</code> class. It is a subclass of <code>ParseObject</code> that we can use to represent geographic locations. We'll discuss how to retrieve location information using the Google Maps API in <a href="https://www.parse.com/tutorials/anywall-android#5-user-location">Section 5</a>. In this section, we'll walk through Anywall's data model that's defined in the <code>AnywallPost</code> Class. Then, we'll explore <code>MainActivity</code> to see how to create and store <code>ParseGeoPoint</code>s as part of creating a new post.</p>

<h2>3.1 Data model</h2>

<div style="background:#EEE;padding:10px;float:left;margin-left:20px;border-width:1px;border-color:#555;border-style:solid;">
      <h2 style="margin-bottom: 10px !important;margin-top: 0px !important;background-color: #EEE !important;">Posts</h2>
      <p style="margin:0px">text : <strong>String</strong></p>
      <p style="margin:0px">location : <strong>GeoPoint</strong></p>
      <p style="margin:0px">user : <strong>Pointer&lt;_User&gt;</strong></p>
    </div>


<br><br><br><br><br><br><br>


<p>Anywall's content is stored on Parse in a <code>Posts</code> Class. The data model consists of a <code>text</code> key, a <code>location</code> key, and a <code>user</code> key. The <code>location</code> key defines the location where the post was created. The <code>user</code> represents the user who created the post. Let's look at how to represent this in code.</p>

<p><code>Posts</code> is a <code>ParseObject</code> with three attributes: a <code>String</code> text, a <code>GeoPoint</code> location, and a <code>Pointer</code> to a <code>_User</code> object. We could certainly use <code>ParseObject</code> directly in this app when querying or setting data on <code>Posts</code>. However, creating a subclass of <code>ParseObject</code> gives us strongly-typed access to our data and makes working with <code>Posts</code> much more convenient:</p>

<div class="code parseTheme"><div><div id="highlighter_279989" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// AnywallPost.java</code></div><div class="line number2 index1 alt1"><code class="java plain">...</code></div><div class="line number3 index2 alt2"><code class="java color1">@ParseClassName</code><code class="java plain">(</code><code class="java string">"Posts"</code><code class="java plain">)</code></div><div class="line number4 index3 alt1"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">AnywallPost </code><code class="java keyword">extends</code> <code class="java plain">ParseObject {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">String getText() {</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">getString(</code><code class="java string">"text"</code><code class="java plain">);</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">setText(String value) {</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">put(</code><code class="java string">"text"</code><code class="java plain">, value);</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">ParseUser getUser() {</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">getParseUser(</code><code class="java string">"user"</code><code class="java plain">);</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">setUser(ParseUser value) {</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">put(</code><code class="java string">"user"</code><code class="java plain">, value);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">ParseGeoPoint getLocation() {</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">getParseGeoPoint(</code><code class="java string">"location"</code><code class="java plain">);</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number24 index23 alt1">&nbsp;</div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">setLocation(ParseGeoPoint value) {</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">put(</code><code class="java string">"location"</code><code class="java plain">, value);</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number28 index27 alt1">&nbsp;</div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java plain">ParseQuery&lt;AnywallPost&gt; getQuery() {</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">ParseQuery.getQuery(AnywallPost.</code><code class="java keyword">class</code><code class="java plain">);</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number32 index31 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>The subclass contains only getters and setters for the underlying <code>ParseObject</code> data. The <code>@ParseClassName</code> annotation associates this class definition with a class of <code>ParseObject</code>. The class also defines a <code>getQuery()</code> static method that allows us to conveniently query an object of type <code>AnywallPost</code> using <code>post.getQuery()</code>. This will come in handy later when we're setting up the posts display logic.</p>

<h2>3.2 Saving <code>AnywallPost</code> data to Parse</h2>

<p>Now that we've defined the data model, let's look at how new data is saved to Parse. We're going to add a button that the user clicks to show a view where they can create a new post. The user enters the wall post text and clicks a button to send data to Parse. The text and the user's current location is sent to Parse and the user is brought back to the main view where the new content should now be available:</p>

<div style="float:left;margin-left:20px;width:100%;">
      <img src="https://github.com/caabernathy/images/raw/master/anywall/create_post_1_1.png" alt="Create a post" width="180" height="320" align="left" style="padding:0px 10px 10px 10px;">
      <img src="./Anywall Android   Parse_files/create_post_2.png" alt="New post saved" width="180" height="320" align="left" style="padding:0px 10px 10px 10px;">
    </div>


<br><br><br><br><br><br><br>


<p>This sub-section concentrates on the logic for displaying the post creation view and saves the data. The location-related logic is covered in <a href="https://www.parse.com/tutorials/anywall-android#5-user-location">Section 5</a>. Let's first add a <code>Button</code> widget in <code>MainActivity</code>'s layout to trigger the transition to <code>PostActivity</code> where new wall posts are created:</p>

<div class="code parseTheme"><div><div id="highlighter_189900" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">&lt;LinearLayout ...&gt;</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;Button</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:id=</code><code class="java string">"@+id/post_button"</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:layout_width=</code><code class="java string">"match_parent"</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:layout_height=</code><code class="java string">"wrap_content"</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:text=</code><code class="java string">"@string/post"</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:textAppearance=</code><code class="java string">"?android:attr/textAppearanceSmallInverse"</code> <code class="java plain">/&gt;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number10 index9 alt1"><code class="java plain">&lt;/LinearLayout&gt;</code></div></div></td></tr></tbody></table></div></div></div>


<p>We then add logic in <code>MainActivity</code> to transition to <code>PostActivity</code> when the button is clicked:</p>

<div class="code parseTheme"><div><div id="highlighter_895234" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java color1">@Override</code></div><div class="line number2 index1 alt1"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onCreate(Bundle savedInstanceState) {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 1</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Button postButton = (Button) findViewById(R.id.post_button);</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">postButton.setOnClickListener(</code><code class="java keyword">new</code> <code class="java plain">OnClickListener() {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onClick(View v) {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 2</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Location myLoc = (currentLocation == </code><code class="java keyword">null</code><code class="java plain">) ? lastLocation : currentLocation;</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(myLoc == </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Toast.makeText(MainActivity.</code><code class="java keyword">this</code><code class="java plain">,</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java string">"Please try again after your location appears on the map."</code><code class="java plain">, Toast.LENGTH_LONG).show();</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 3</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Intent intent = </code><code class="java keyword">new</code> <code class="java plain">Intent(MainActivity.</code><code class="java keyword">this</code><code class="java plain">, PostActivity.</code><code class="java keyword">class</code><code class="java plain">);</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">intent.putExtra(Application.INTENT_EXTRA_LOCATION, myLoc);</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">startActivity(intent);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">});</code></div><div class="line number21 index20 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>Let's walk through this code step by step:</p>

<ol>
<li>We retrieve the button from the <code>postButton</code> resource in our layout so we can set up its <code>OnClickListener</code> handler.</li>
<li>We check that we have a current location reading. We make use of private fields to store the user's last known and current location. The logic for updating these fields will be covered in <a href="https://www.parse.com/tutorials/anywall-android#5-user-location">Section 5</a> when we discuss the Google Maps API. If we don't have a location reading, we display an error.</li>
<li>We start an intent for <code>PostActivity</code> and pass along the current location as extra data.</li>
</ol>


<p>Now let's transition to <code>PostActivity</code> where new wall posts are created. We'll first extract the location data in <code>onCreate</code></p>

<div class="code parseTheme"><div><div id="highlighter_106003" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java plain">ParseGeoPoint geoPoint;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java color1">@Override</code></div><div class="line number4 index3 alt1"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onCreate(Bundle savedInstanceState) {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Intent intent = getIntent();</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Location location = intent.getParcelableExtra(Application.INTENT_EXTRA_LOCATION);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">geoPoint = </code><code class="java keyword">new</code> <code class="java plain">ParseGeoPoint(location.getLatitude(), location.getLongitude());</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number10 index9 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>We convert the location to a <code>ParseGeoPoint</code> representation for storing on Parse.</p>

<p>The user interface for this activity displays a text entry view, a count showing the number of characters entered as well as the maximum allowed, and a "Post" button to post the content. Let's look at how these UI views are set up, starting with the text entry field:</p>

<div class="code parseTheme"><div><div id="highlighter_476920" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">postEditText = (EditText) findViewById(R.id.post_edittext);</code></div><div class="line number2 index1 alt1"><code class="java plain">postEditText.addTextChangedListener(</code><code class="java keyword">new</code> <code class="java plain">TextWatcher() {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">afterTextChanged(Editable s) { </code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">updatePostButtonState();</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">updateCharacterCountTextViewText();</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">} </code></div><div class="line number9 index8 alt2"><code class="java plain">});</code></div></div></td></tr></tbody></table></div></div></div>


<p>The <code>postEditText</code> text field is retrieved from layout and a listener added to detect text changes. It makes use of two methods that we don't show in the tutorial but which you can view by checking out the source code. The <code>updatePostButtonState</code> private method takes of enabling or disabling the "Post" submit button. The <code>updateCharacterCountTextViewText</code> private method takes care of updating the displayed character count.</p>

<p>We add a "Post" button that, if enabled, sends data to Parse:</p>

<div class="code parseTheme"><div><div id="highlighter_778705" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">postButton = (Button) findViewById(R.id.post_button);</code></div><div class="line number2 index1 alt1"><code class="java plain">postButton.setOnClickListener(</code><code class="java keyword">new</code> <code class="java plain">OnClickListener() { </code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onClick(View v) { </code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">post();</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">} </code></div><div class="line number6 index5 alt1"><code class="java plain">});</code></div></div></td></tr></tbody></table></div></div></div>


<p>The <code>postButton</code> field is first extracted from layout, and a click listener added that calls a private <code>post</code> method when clicked. Let's take a look at the most important function, saving the data:</p>

<div class="code parseTheme"><div><div id="highlighter_124333" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">post () {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 1</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">AnywallPost post = </code><code class="java keyword">new</code> <code class="java plain">AnywallPost();</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">post.setLocation(geoPoint);</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">String text = postEditText.getText().toString().trim();</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">post.setText(text);</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">post.setUser(ParseUser.getCurrentUser());</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 2</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ParseACL acl = </code><code class="java keyword">new</code> <code class="java plain">ParseACL();</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">acl.setPublicReadAccess(</code><code class="java keyword">true</code><code class="java plain">);</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">post.setACL(acl);</code></div><div class="line number13 index12 alt2">&nbsp;</div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 3</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">post.saveInBackground(</code><code class="java keyword">new</code> <code class="java plain">SaveCallback() { </code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">done(ParseException e) { </code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">finish();</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">});</code></div><div class="line number21 index20 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>Let's walk through this implementation step by step:</p>

<ol>
<li>A new <code>AnywallPost</code> object is created and the <code>location</code>, <code>text</code> and <code>user</code> fields set. Note that the <code>user</code> is set to the app's current user.</li>
<li>The permissions for the object is set to a read-only <a href="https://www.parse.com/docs/android_guide#users-acls">access control list</a> for everyone.</li>
<li>The object is saved in a background thread. The callback handler simply finishes the activity. We'll cover how to view posts in the next section.</li>
</ol>


<p><a name="4-view-posts"></a></p>

<h1>4. View Posts</h1>

<p>The key user experience in Anywall involves viewing the posts created. For this, we'll dive deeper into how the data stored on Parse is queried to help create the display. There are two ways the data is displayed: on a map using <a href="http://developer.android.com/reference/com/google/android/gms/maps/SupportMapFragment.html"><code>SupportMapFragment</code></a> and in a list using <a href="http://developer.android.com/reference/android/widget/ListView.html"><code>ListView</code></a>:</p>

<div style="float:left;margin-left:20px;width:100%;">
      <img src="./Anywall Android   Parse_files/view_posts_map.png" alt="View posts on map" width="180" height="124" align="left" style="padding:0px 10px 10px 10px;">
      <img src="./Anywall Android   Parse_files/view_posts_list.png" alt="View posts on list" width="180" height="129" align="left" style="padding:0px 10px 10px 10px;">
    </div>


<br><br><br><br><br><br><br>


<p>We'll tackle each of these scenarios separately and see how the user's current location plays a part in the query. We'll then take a deep dive into the Google Maps API and how see it's used to track and provide the user's current location.</p>

<h2>4.1 Displaying posts a map</h2>

<p>We have the option of using <code>MapFragment</code> to display the posts on a map. Since we're looking to support platforms prior to Android 3.0, we're using <code>SupportMapFragment</code>. Each post is represented on our map as a marker and users are able to select one to see more details about that post: it's text and creator.</p>

<p>To get going, we add the map component to <code>MainActivity</code>'s layout:</p>

<div class="code parseTheme"><div><div id="highlighter_859133" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">&lt;LinearLayout ...&gt;</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;fragment</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:id=</code><code class="java string">"@+id/map_fragment"</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:name=</code><code class="java string">"com.google.android.gms.maps.SupportMapFragment"</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:layout_width=</code><code class="java string">"fill_parent"</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:layout_height=</code><code class="java string">"fill_parent"</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:layout_weight=</code><code class="java string">"1"</code> <code class="java plain">/&gt;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number10 index9 alt1"><code class="java plain">&lt;/LinearLayout&gt;</code></div></div></td></tr></tbody></table></div></div></div>


<p>We then retrieve the map fragment from it's resource id in <code>onCreate</code> to set up the map properties:</p>

<div class="code parseTheme"><div><div id="highlighter_163596" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">mapFragment = (SupportMapFragment) </code><code class="java keyword">this</code><code class="java plain">.getSupportFragmentManager().findFragmentById(R.id.map_fragment);</code></div><div class="line number2 index1 alt1"><code class="java comments">// Enable the current location "blue dot"</code></div><div class="line number3 index2 alt2"><code class="java plain">mapFragment.getMap().setMyLocationEnabled(</code><code class="java keyword">true</code><code class="java plain">);</code></div><div class="line number4 index3 alt1"><code class="java comments">// Set up the camera change handler</code></div><div class="line number5 index4 alt2"><code class="java plain">mapFragment.getMap().setOnCameraChangeListener(</code><code class="java keyword">new</code> <code class="java plain">OnCameraChangeListener() {</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onCameraChange(CameraPosition position) {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Run the map query</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number9 index8 alt2"><code class="java plain">});</code></div></div></td></tr></tbody></table></div></div></div>


<p>The underlying Google map can be retrieved from the map fragment by calling <code>getMap()</code> on the <code>SupportMapFragment</code> instance. We enable visible tracking of the user's current location by calling <code>setMyLocationEnabled(true)</code>. We next add a property to respond to changes in the map view. The Google map view is modeled as a camera looking down on a flat pane. The map view can change based on the position of the camera. We react to map view changes by setting up an <code>OnCameraChangeListener</code> listener. The <code>onCameraChange</code> implementation of the listener runs a map query by calling a private <code>doMapQuery()</code> helper method:</p>

<div class="code parseTheme"><div><div id="highlighter_754641" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java keyword">final</code> <code class="java keyword">int</code> <code class="java plain">MAX_POST_SEARCH_DISTANCE = </code><code class="java value">100</code><code class="java plain">;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">doMapQuery() {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 1</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Location myLoc = (currentLocation == </code><code class="java keyword">null</code><code class="java plain">) ? lastLocation : currentLocation;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(myLoc == </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">cleanUpMarkers(</code><code class="java keyword">new</code> <code class="java plain">HashSet&lt;String&gt;());</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 2</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java plain">ParseGeoPoint myPoint = geoPointFromLocation(myLoc);</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 3</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ParseQuery&lt;AnywallPost&gt; mapQuery = AnywallPost.getQuery();</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 4</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">mapQuery.whereWithinKilometers(</code><code class="java string">"location"</code><code class="java plain">, myPoint, MAX_POST_SEARCH_DISTANCE);</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 5</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">mapQuery.include(</code><code class="java string">"user"</code><code class="java plain">);</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">mapQuery.orderByDescending(</code><code class="java string">"createdAt"</code><code class="java plain">);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">mapQuery.setLimit(MAX_POST_SEARCH_RESULTS);</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 6</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">mapQuery.findInBackground(</code><code class="java keyword">new</code> <code class="java plain">FindCallback&lt;AnywallPost&gt;() {</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">done(List&lt;AnywallPost&gt; objects, ParseException e) {</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Handle the results</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">});</code></div><div class="line number27 index26 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>Let's walk through the map query code step by step:</p>

<ol>
<li>We need the user's current location to use in our query. So we get this from <code>lastLocation</code> or <code>currentLocation</code>. If there is no current location available we call a private helper method to remove all current marker information.</li>
<li>We convert the user's location to a <code>ParseGeoPoint</code> to run in our Parse query.</li>
<li>We set up a <code>ParseQuery</code> to get <code>AnywallPost</code> data then set up filters in the follow-on steps to get the data we need.</li>
<li>We add a query filter to look for posts whose <code>location</code> key value is within a certain distance from the user. We're going to use an arbitrarily large distance of 100km. This shouldn't present a problem as we're also limiting the results returned to 20 posts. When we handle the results we'll hide the text for posts outside the user's search radius preference.</li>
<li>We filter the query further to include the related <code>user</code> information in the data returned, to order the data returned by most recent first, and to limit the number of records returned to 20.</li>
<li>Finally, we execute the query in a background thread and set up a callback to handle the results.</li>
</ol>


<p>We use the following helper method to convert a location to a <code>ParseGeoPoint</code>:</p>

<div class="code parseTheme"><div><div id="highlighter_180254" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java plain">ParseGeoPoint geoPointFromLocation(Location loc) {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">new</code> <code class="java plain">ParseGeoPoint(loc.getLatitude(), loc.getLongitude());</code></div><div class="line number3 index2 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>The private <code>cleanUpMarkers()</code> method that cleans up any existing map markers is listed below:</p>

<div class="code parseTheme"><div><div id="highlighter_152533" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">cleanUpMarkers(Set&lt;String&gt; markersToKeep) {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(String objId : </code><code class="java keyword">new</code> <code class="java plain">HashSet&lt;String&gt;(mapMarkers.keySet())) {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!markersToKeep.contains(objId)) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Marker marker = mapMarkers.get(objId);</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">marker.remove();</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mapMarkers.get(objId).remove();</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mapMarkers.remove(objId);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number10 index9 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>The method takes in a set of <code>AnywallPost</code> object ids that should remain on the map. It checks this list against a <code>mapMarkers</code> private field that contains a <code>HashMap</code> of previously saved map markers and their corresponding <code>AnywallPost</code> <code>id</code>s. The method loops through the <code>mapMarkers</code> hash keys that represent the ids of the posts on the map. It then tests each id against the ids in the <code>markersToKeep</code> list. Ids not found in the list are removed from the map view and the <code>mapMarkers</code> hash.</p>

<p>Getting back to our map query. Now that we have our map query results, let's look at how to handle this in the callback. What we're looking to do is add markers representing the post locations and add properties behind those markers to display additional details when selected. Note that our query also returns posts outside the user's search preference since we searched within a 100km distance. Markers that lie outside the user's search radius preference are marked red and show a standard message. Markers that lie within the search radius prefernce are marked green and show post details.</p>

<p>Here's the <code>FindCallback&lt;AnywallPost&gt;</code> handler's <code>done</code> implementation for handing our results:</p>

<div class="code parseTheme"><div><div id="highlighter_108799" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java color1">@Override</code></div><div class="line number2 index1 alt1"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">done(List&lt;AnywallPost&gt; objects, ParseException e) {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// Check for errors</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// No errors, process query results</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 1</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Set&lt;String&gt; toKeep = </code><code class="java keyword">new</code> <code class="java plain">HashSet&lt;String&gt;();</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 2</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(AnywallPost post : objects) {</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 3</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">toKeep.add(post.getObjectId());</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 4</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Marker oldMarker = mapMarkers.get(post.getObjectId());</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 5</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">MarkerOptions markerOpts =</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">new</code> <code class="java plain">MarkerOptions().position(</code><code class="java keyword">new</code> <code class="java plain">LatLng(post.getLocation().getLatitude(), post</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.getLocation().getLongitude()));</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 6</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(post.getLocation().distanceInKilometersTo(myPoint) &gt; radius * METERS_PER_FEET</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">/ METERS_PER_KILOMETER) {</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Set up an out-of-range marker</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Set up an in-range marker</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 7</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Marker marker = mapFragment.getMap().addMarker(markerOpts);</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mapMarkers.put(post.getObjectId(), marker);</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 8</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(post.getObjectId().equals(selectedPostObjectId)) {</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">marker.showInfoWindow();</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">selectedPostObjectId = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number35 index34 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 9</code></div><div class="line number36 index35 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">cleanUpMarkers(toKeep);&nbsp; </code></div><div class="line number37 index36 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>This code adds relevant markers to the map view. Let's walk through this code step by step:</p>

<ol>
<li>We initialize a <code>toKeep</code> hash variable for the markers that should remain on the map.</li>
<li>We loop through all the <code>AnywallPost</code> objects returned in the query.</li>
<li>We update the <code>toKeep</code> hash of map markers to keep.</li>
<li>We want to optimize the marker display logic and avoid adding markers that are currently visible on the map view. The <code>mapMarkers</code> variable contains a hash map of previously saved map markers. We're looking for a marker for the <code>AnywallPost</code> object we're currently looping through.
We set up <code>oldMarker</code> to check <code>mapMarkers</code> for an entry corresponding to the current <code>AnywallPost</code> object.</li>
<li>We then initialize a new <a href="http://developer.android.com/reference/com/google/android/gms/maps/model/MarkerOptions.html"><code>MarkerOptions</code></a> to hold the marker properties starting with the <code>AnywallPost</code> location.</li>
<li>Next, we want to set up additional marker properties based on whether the marker is within the user's search radius preference or not. We also make sure not to add a marker if it already exists and has the desired properties.</li>
<li>Next, we add the marker to the map's view and also add it to the <code>mapMarkers</code> hash of currently visible markers.</li>
<li>We keep track of the currently selected post's <code>id</code> in the <code>selectedPostObjectId</code> private field. This helps maintain UI consistency whenever queries are updated whilst a marker is selected. If the current <code>AnywallPost</code> object was previously selected, we call the <code>showInfoWindow()</code> marker method to display the post details.</li>
<li>We call the <code>cleanUpMarkers()</code> method and pass in the <code>toKeep</code> variable to remove any unwanted markers from the map.</li>
</ol>


<p>Let's look at how we set up the marker properties. For markers outside the user's search radius we use the following:</p>

<div class="code parseTheme"><div><div id="highlighter_618816" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// Set up an out-of-range marker</code></div><div class="line number2 index1 alt1"><code class="java keyword">if</code> <code class="java plain">(oldMarker != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(oldMarker.getSnippet() == </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">continue</code><code class="java plain">;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">oldMarker.remove();</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number8 index7 alt1"><code class="java plain">}</code></div><div class="line number9 index8 alt2"><code class="java plain">markerOpts =</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">markerOpts.title(getResources().getString(R.string.post_out_of_range))</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.icon(BitmapDescriptorFactory.defaultMarker(</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">BitmapDescriptorFactory.HUE_RED));</code></div></div></td></tr></tbody></table></div></div></div>


<p>This checks for an existing marker. There's an additional check to see if the marker is an out-of-range marker, i.e. it doesn't have a snippet. If so, we skip to check the next query result. If the marker does have a snippet it's an in-range marker that we need to convert to an out-of-range marker. So to prepare for this, we remove it from the <code>mapMarkers</code> list. Finally we set the marker icon color to red and use a standard message, represented by the <code>post_out_of_range</code> string resource.</p>

<p>Setting up an markers that are within the search radius is quite similar:</p>

<div class="code parseTheme"><div><div id="highlighter_82853" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// Set up an in-range marker</code></div><div class="line number2 index1 alt1"><code class="java keyword">if</code> <code class="java plain">(oldMarker != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(oldMarker.getSnippet() != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">continue</code><code class="java plain">;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">oldMarker.remove();</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number8 index7 alt1"><code class="java plain">}</code></div><div class="line number9 index8 alt2"><code class="java plain">markerOpts =</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">markerOpts.title(post.getText())</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.snippet(post.getUser().getUsername())</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.icon(BitmapDescriptorFactory.defaultMarker(</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">BitmapDescriptorFactory.HUE_GREEN));</code></div></div></td></tr></tbody></table></div></div></div>


<p>The difference is, an in-range marker has a snippet and we test for that when deciding to skip to the next result in the for loop. The other difference is the marker icon is set to green and we set the marker's title to the post's <code>text</code> field and the marker's snippet to the post creator's username.</p>

<p>Now that we've discussed how to handle the map query, let's look at when the method's invoked. If you recall, we set up the <code>doMapQuery()</code> method to react to camera position changes. It also makes sense to run this query when <code>MainActivity</code> is visible to the user and they can begin interacting with it. For this reason, we add a call to <code>doMapQuery()</code> in the <code>onResume</code> method:</p>

<div class="code parseTheme"><div><div id="highlighter_774827" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java color1">@Override</code></div><div class="line number2 index1 alt1"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onResume() {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">doMapQuery();</code></div><div class="line number5 index4 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>We also call <code>doMapQuery()</code> when a new post is saved to refresh the map view and show the new data:</p>

<div class="code parseTheme"><div><div id="highlighter_136460" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">post.saveInBackground(</code><code class="java keyword">new</code> <code class="java plain">SaveCallback() {</code></div><div class="line number2 index1 alt1"><code class="java color1">@Override</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">done(ParseException e) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">doMapQuery();</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number6 index5 alt1"><code class="java plain">});</code></div></div></td></tr></tbody></table></div></div></div>


<p>Finally, we call <code>doMapQuery()</code> whenever the locations services API reports a significant change in the user's location:</p>

<div class="code parseTheme"><div><div id="highlighter_575268" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onLocationChanged(Location location) {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">doMapQuery();</code></div><div class="line number4 index3 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<h2>4.2 Displaying posts in a list</h2>

<p>Anywall posts are also displayed as a list using a <code>ListView</code> widget. Each row in the list displays the post's text and the creator. When users tap a list view item, the corresponding marker is highlighted in the map we set up in the previous section.</p>

<p>To set up the list view, we first add the component to the layout used in <code>MainActivity</code>:</p>

<div class="code parseTheme"><div><div id="highlighter_909489" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">&lt;LinearLayout ...&gt;</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;ListView</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:id=</code><code class="java string">"@+id/posts_listview"</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:layout_width=</code><code class="java string">"fill_parent"</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:layout_height=</code><code class="java string">"fill_parent"</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">android:layout_weight=</code><code class="java string">"1"</code> <code class="java plain">&gt;</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&lt;/ListView&gt;</code></div><div class="line number9 index8 alt2"><code class="java plain">&lt;/LinearLayout&gt;</code></div></div></td></tr></tbody></table></div></div></div>


<p>To display content in the <code>ListView</code>, we need to set up an <a href="http://developer.android.com/reference/android/widget/Adapter.html"><code>Adapter</code></a> backed by the posts retrieved from Parse. Parse provides an implementation of <code>Adapter</code> that does the heavy lifting needed to create the desired query and configure the data display. We'll make use of <code>ParseQueryAdapter</code> to set up our <code>AnywallPost</code> query and attach it to our <code>ListView</code>.</p>

<p>The simplest to use <code>ParseQueryAdapter</code> to set up our <code>ListView</code> display is shown below:</p>

<div class="code parseTheme"><div><div id="highlighter_170338" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onCreate(Bundle savedInstanceState) {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ParseQueryAdapter&lt;AnywallPost&gt; adapter = </code><code class="java keyword">new</code> <code class="java plain">ParseQueryAdapter&lt;AnywallPost&gt;(</code><code class="java keyword">this</code><code class="java plain">, AnywallPost.</code><code class="java keyword">class</code><code class="java plain">);</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">adapter.setTextKey(</code><code class="java string">"text"</code><code class="java plain">);</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">ListView postsListView = (ListView) </code><code class="java keyword">this</code><code class="java plain">.findViewById(R.id.posts_listview);</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">listView.setAdapter(adapter);</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number8 index7 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>This results in a <code>ListView</code> displaying only the post's <code>text</code> field in each row. The data displayed comes from a <code>Posts</code> query with the most recent posts shown first. There is no location filtering in the returned data. <code>ParseQueryAdapter</code> also paginates the results returning at most 100 items. We're looking to customize and configure our view some more. There are two main things we want to do, show the post creator's username in each row and filter our query results. Furthermore, we'd like to configure our adapter to control when the data is loaded and how much data is displayed.</p>

<p>Parse allows us to customize the query used in <code>ParseQueryAdapter</code>. We do this by setting up a <code>QueryFactory</code> that returns the desired <code>ParseQuery</code> in it's <code>create()</code> method. We then construct our <code>ParseQueryAdapter</code> with this <code>QueryFactory</code>:</p>

<div class="code parseTheme"><div><div id="highlighter_369766" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">ParseQueryAdapter.QueryFactory&lt;AnywallPost&gt; factory =</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">new</code> <code class="java plain">ParseQueryAdapter.QueryFactory&lt;AnywallPost&gt;() {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">ParseQuery&lt;AnywallPost&gt; create() {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Location myLoc = (currentLocation == </code><code class="java keyword">null</code><code class="java plain">) ? lastLocation : currentLocation;</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ParseQuery&lt;AnywallPost&gt; query = AnywallPost.getQuery();</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">query.include(</code><code class="java string">"user"</code><code class="java plain">);</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">query.orderByDescending(</code><code class="java string">"createdAt"</code><code class="java plain">);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">query.whereWithinKilometers(</code><code class="java string">"location"</code><code class="java plain">, geoPointFromLocation(myLoc), radius</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">* METERS_PER_FEET / METERS_PER_KILOMETER);</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">query.setLimit(MAX_POST_SEARCH_RESULTS);</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">query;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div></div>


<p>The code above returns a <code>QueryFactory</code> that defines a query for posts data. The query includes the <code>user</code> info in the result set. The results are ordered by most recently created first. The query is also filtered to find posts where the <code>location</code> field is within a given distance from the user's most recent location. Finally, our query is filtered to limit the number of results returned.</p>

<p>We pass this <code>QueryFactory</code> into the constructor for our <code>ParseQueryAdapter</code>:</p>

<div class="code parseTheme"><div><div id="highlighter_656981" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java plain">ParseQueryAdapter&lt;AnywallPost&gt; postsQueryAdapter;</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onCreate(Bundle savedInstanceState) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">postsQueryAdapter = </code><code class="java keyword">new</code> <code class="java plain">ParseQueryAdapter&lt;AnywallPost&gt;(</code><code class="java keyword">this</code><code class="java plain">, factory);</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number7 index6 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>The next order of business is customizing our <code>ListView</code> display. To customize the <code>ListView</code> rows to display username data, we override <code>getItemView(ParseObject, View, ViewGroup)</code>. Our implementation uses our own layout, defined in <code>anywall_post_item.xml</code> that contains two <code>TextView</code> widgets. One widget displays the post's text and the second the post creator's username. The implementation inflates this layout then configures the layout:</p>

<div class="code parseTheme"><div><div id="highlighter_219668" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">postsQueryAdapter = </code><code class="java keyword">new</code> <code class="java plain">ParseQueryAdapter&lt;AnywallPost&gt;(</code><code class="java keyword">this</code><code class="java plain">, factory) {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">View getItemView(AnywallPost post, View view, ViewGroup parent) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(view == </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">view = View.inflate(getContext(), R.layout.anywall_post_item, </code><code class="java keyword">null</code><code class="java plain">);</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TextView contentView = (TextView) view.findViewById(R.id.content_view);</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">TextView usernameView = (TextView) view.findViewById(R.id.username_view);</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">contentView.setText(post.getText());</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">usernameView.setText(post.getUser().getUsername());</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">view;</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number13 index12 alt2"><code class="java plain">};</code></div></div></td></tr></tbody></table></div></div></div>


<p>We also want to configure our adapter further since we rely on the user's location being set before we want to show any nearby posts. By default, <code>ParseQueryAdapter</code> automatically loads the results from the query when it is attached to our <code>ListView</code>. We'd like to disable this and control when the results are loaded. Another configuration option we'd like is to disable the default pagination so we can display the certain number of results. The following two adapter customizations achieve these goals:</p>

<div class="code parseTheme"><div><div id="highlighter_750212" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">postsQueryAdapter.setAutoload(</code><code class="java keyword">false</code><code class="java plain">);</code></div><div class="line number2 index1 alt1"><code class="java plain">postsQueryAdapter.setPaginationEnabled(</code><code class="java keyword">false</code><code class="java plain">);</code></div></div></td></tr></tbody></table></div></div></div>


<p>We'll be adding the logic to load our results shortly. The next step we make in our setup is attaching our adapter to the <code>ListView</code> retrieved from our layout:</p>

<div class="code parseTheme"><div><div id="highlighter_136935" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">ListView postsListView = (ListView) </code><code class="java keyword">this</code><code class="java plain">.findViewById(R.id.posts_listview);</code></div><div class="line number2 index1 alt1"><code class="java plain">postsListView.setAdapter(postsQueryAdapter);</code></div></div></td></tr></tbody></table></div></div></div>


<p>Lastly, let's set up a click handler on our <code>ListView</code> rows to highlight the selected post on our map:</p>

<div class="code parseTheme"><div><div id="highlighter_97091" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">postsListView.setOnItemClickListener(</code><code class="java keyword">new</code> <code class="java plain">OnItemClickListener() {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onItemClick(AdapterView&lt; ?&gt; parent, View view, </code><code class="java keyword">int</code> <code class="java plain">position, </code><code class="java keyword">long</code> <code class="java plain">id) {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java plain">AnywallPost item = postsQueryAdapter.getItem(position);</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">selectedPostObjectId = item.getObjectId();</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mapFragment.getMap().animateCamera(</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">CameraUpdateFactory.newLatLng(</code><code class="java keyword">new</code> <code class="java plain">LatLng(item.getLocation().getLatitude(), item</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.getLocation().getLongitude())), </code><code class="java keyword">new</code> <code class="java plain">CancelableCallback() {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onFinish() {</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Marker marker = mapMarkers.get(item.getObjectId());</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(marker != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">marker.showInfoWindow();</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onCancel() { }</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">});</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Marker marker = mapMarkers.get(item.getObjectId());</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(marker != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">marker.showInfoWindow();</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number22 index21 alt1"><code class="java plain">});</code></div></div></td></tr></tbody></table></div></div></div>


<p>The <code>onItemClick</code> implementation in our listener finds the <code>AnywallPost</code> that's selected. The map's camera is then moved to the post's location using <code>animateCamera(CameraUpdate update, GoogleMap.CancelableCallback callback)</code>. When the animation completes, the post marker's information is displayed on the map, if available.</p>

<p>Let's turn our attention to fetching the user's posts since we've disable automatic loading. We can call the <code>loadObjects()</code> method on our <code>ParseQueryAdapter</code> to manually fetch the data. We define a private helper method that triggers the query when we have the user's latest location:</p>

<div class="code parseTheme"><div><div id="highlighter_325465" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">doListQuery() {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Location myLoc = (currentLocation == </code><code class="java keyword">null</code><code class="java plain">) ? lastLocation : currentLocation;</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(myLoc != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">postsQueryAdapter.loadObjects();</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number6 index5 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>We then call <code>doListQuery()</code> whenever <code>MainActivity</code> is visible to the user:</p>

<div class="code parseTheme"><div><div id="highlighter_975165" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java color1">@Override</code></div><div class="line number2 index1 alt1"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onResume() {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">doListQuery();</code></div><div class="line number5 index4 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>We also call <code>doListQuery()</code> when a new post is saved:</p>

<div class="code parseTheme"><div><div id="highlighter_200737" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">post.saveInBackground(</code><code class="java keyword">new</code> <code class="java plain">SaveCallback() {</code></div><div class="line number2 index1 alt1"><code class="java color1">@Override</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">done(ParseException e) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">doListQuery();</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number7 index6 alt2"><code class="java plain">});</code></div></div></td></tr></tbody></table></div></div></div>


<p>Finally, we fetch the data whenever the locations services API reports a significant change in the user's location:</p>

<div class="code parseTheme"><div><div id="highlighter_418828" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onLocationChanged(Location location) {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">doListQuery();</code></div><div class="line number4 index3 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<h2>4.3 Implementing search preferences</h2>

<p>The user can customize the search radius for the posts displayed. The selection UI is handled in <code>SettingsActivity</code> and the data stored in <a href="http://developer.android.com/reference/android/content/SharedPreferences.html"><code>SharedPreferences</code></a> by calling a setter in Anywall's <code>Application</code> class. The search radius getter is also defined in  <code>Application</code>, and is used in <code>MainActivity</code> to set up the data queries and to re-orient the map whenever the search radius changes.</p>

<p><a name="5-user-location"></a></p>

<h1>5. Track a User's Location</h1>

<p>The Location Services API, offered through Google Play services, enables us to make Anywall location-aware. We can use these APIs to get the user's current location and receive location updates. We then use this information to provide the location data for new posts as well as update Anywall's UI when the user's location changes significantly. We'll be covering a small subset of the functionality available in the Location Services library. For more information, check out Android's <a href="https://developer.android.com/training/location/index.html">Location Awareness Guide</a> and the <a href="http://developer.android.com/google/play-services/location.html">Google Play services Location API Guide</a>.</p>

<p>Here are the steps we'll take to make Anywall location-aware:</p>

<ol>
<li>Include the Google Play services SDK.</li>
<li>Set up the app permissions.</li>
<li>Check that Google Play services are available.</li>
<li>Create our location client.</li>
<li>Define the Location Services callbacks.</li>
<li>Manage our location client during the activity's lifecycle.</li>
</ol>


<p>Anywall includes the Google Play services SDK that's required to use Location Services. Refer to the <a href="https://developer.android.com/google/play-services/setup.html">Google Play services setup instructions</a> for more details on this.</p>

<p>Next, we set up Anywall to ask for location permissions. This is specified in the app's manifest. In Anywall, we're requesting <code>ACCESS_FINE_LOCATION</code> to provide us with more precise location information:</p>

<div class="code parseTheme"><div><div id="highlighter_438289" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java plain">&lt;uses-permission android:name=</code><code class="java string">"android.permission.ACCESS_FINE_LOCATION"</code> <code class="java plain">/&gt;</code></div></div></td></tr></tbody></table></div></div></div>


<p>As we retrieve and track a user's location, we need to check if Google Play services are enabled on the user's device. If we find a problem, we can help resolve this by showing the user a message so they can take corrective action. Let's define a method to perform this check:</p>

<div class="code parseTheme"><div><div id="highlighter_271141" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// MainActivity.java</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java keyword">class</code> <code class="java plain">ErrorDialogFragment </code><code class="java keyword">extends</code> <code class="java plain">DialogFragment {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">Dialog mDialog;</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">ErrorDialogFragment() {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">();</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mDialog = </code><code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">setDialog(Dialog dialog) {</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">mDialog = dialog;</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java plain">Dialog onCreateDialog(Bundle savedInstanceState) {</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">mDialog;</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number19 index18 alt2"><code class="java plain">}</code></div><div class="line number20 index19 alt1">&nbsp;</div><div class="line number21 index20 alt2"><code class="java keyword">private</code> <code class="java keyword">boolean</code> <code class="java plain">servicesConnected() {</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">resultCode = GooglePlayServicesUtil.isGooglePlayServicesAvailable(</code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number23 index22 alt2">&nbsp;</div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(ConnectionResult.SUCCESS == resultCode) {</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">true</code><code class="java plain">;</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number27 index26 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">Dialog dialog = GooglePlayServicesUtil.getErrorDialog(resultCode, </code><code class="java keyword">this</code><code class="java plain">, </code><code class="java value">0</code><code class="java plain">);</code></div><div class="line number28 index27 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(dialog != </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number29 index28 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ErrorDialogFragment errorFragment = </code><code class="java keyword">new</code> <code class="java plain">ErrorDialogFragment();</code></div><div class="line number30 index29 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">errorFragment.setDialog(dialog);</code></div><div class="line number31 index30 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">errorFragment.show(getSupportFragmentManager(), Application.APPTAG);</code></div><div class="line number32 index31 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number33 index32 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">false</code><code class="java plain">;</code></div><div class="line number34 index33 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number35 index34 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>The <code>servicesConnected()</code> method calls <code>GooglePlayServicesUtil.isGooglePlayServicesAvailable()</code> which returns a result code depending on if Google Play services is enabled. If enabled, <code>servicesConnected()</code> returns <code>true</code>. If disabled, <code>servicesConnected()</code> creates a new <code>DialogFragment</code> to display the error message and returns <code>false</code>.</p>

<p>We next set up the location client and define the Location Services callbacks to get the current location:</p>

<div class="code parseTheme"><div><div id="highlighter_656204" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">class</code> <code class="java plain">MainActivity </code><code class="java keyword">extends</code> <code class="java plain">FragmentActivity </code><code class="java keyword">implements</code> <code class="java plain">LocationListener,</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GooglePlayServicesClient.ConnectionCallbacks,</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">GooglePlayServicesClient.OnConnectionFailedListener {</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">LocationRequest locationRequest;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">private</code> <code class="java plain">LocationClient locationClient;</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onCreate(Bundle savedInstanceState) {</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Create a new global location parameters object</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">locationRequest = LocationRequest.create();</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">locationRequest.setInterval(UPDATE_INTERVAL_IN_MILLISECONDS);</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">locationRequest.setPriority(LocationRequest.PRIORITY_HIGH_ACCURACY);</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">locationRequest.setFastestInterval(FAST_INTERVAL_CEILING_IN_MILLISECONDS);</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// Create a new location client, using the enclosing class to handle callbacks.</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">locationClient = </code><code class="java keyword">new</code> <code class="java plain">LocationClient(</code><code class="java keyword">this</code><code class="java plain">, </code><code class="java keyword">this</code><code class="java plain">, </code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number21 index20 alt2">&nbsp;</div><div class="line number22 index21 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>This code shows us modifying <code>MainActivity</code>'s declaration to specify the Location Services callback interfaces that are implemented to handle location connections and location changes. We then declare a <a href="http://developer.android.com/reference/com/google/android/gms/location/LocationClient.html"><code>LocationClient</code></a> variable to manage the Location Services connection and callbacks. Next, we declare a <a href="http://developer.android.com/reference/com/google/android/gms/location/LocationRequest.html"><code>LocationRequest</code></a> variable to hold the location update parameters used by our <code>LocationClient</code> instance. For our location updates, we select the <code>PRIORITY_HIGH_ACCURACY</code> option to get high accuracy results. We also set the <code>UPDATE_INTERVAL_IN_MILLISECONDS</code> parameter to 5 seconds to get real time updates.</p>

<p>A good practice when handling location updates is to disconnect the location client when the relevant activity is no longer visible and connect the location client when the activity is about to become visible. Let's define private helper methods that can be used in our activity lifecycle methods as well as other Location Services callbacks to enable this:</p>

<div class="code parseTheme"><div><div id="highlighter_161629" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">startPeriodicUpdates() {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">locationClient.requestLocationUpdates(locationRequest, </code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number3 index2 alt2"><code class="java plain">}</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="java keyword">private</code> <code class="java keyword">void</code> <code class="java plain">stopPeriodicUpdates() {</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">locationClient.removeLocationUpdates(</code><code class="java keyword">this</code><code class="java plain">);</code></div><div class="line number7 index6 alt2"><code class="java plain">}</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="java keyword">private</code> <code class="java plain">Location getLocation() {</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(servicesConnected()) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">locationClient.getLastLocation();</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java keyword">null</code><code class="java plain">;</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number15 index14 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>In the code above, <code>startPeriodicUpdates()</code> makes a request for location updates and specifies the current class as the <code>LocationListener</code> to handle any location updates. The <code>stopPeriodicUpdates()</code> method stops the reporting of location updates to <code>MainActivity</code>. The <code>getLocation()</code> method makes a call to <code>servicesConnected()</code> to check if Google Play services is available then returns the last known location by calling the <code>getLastLocation()</code> on our <code>LocationClient</code> instance. <code>getLocation()</code> is used throughout <code>MainActivity</code> to get the user's most recent location.</p>

<p>Now that we have our helper methods set up, let's implement the location callbacks:</p>

<div class="code parseTheme"><div><div id="highlighter_208849" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onConnected(Bundle bundle) {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">currentLocation = getLocation();</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">startPeriodicUpdates();</code></div><div class="line number4 index3 alt1"><code class="java plain">}</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;</code>&nbsp;</div><div class="line number6 index5 alt1"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onConnectionFailed(ConnectionResult connectionResult) {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(connectionResult.hasResolution()) {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">try</code> <code class="java plain">{</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">connectionResult.startResolutionForResult(</code><code class="java keyword">this</code><code class="java plain">, CONNECTION_FAILURE_RESOLUTION_REQUEST);</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">catch</code> <code class="java plain">(IntentSender.SendIntentException e) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">showErrorDialog(connectionResult.getErrorCode());</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number15 index14 alt2"><code class="java plain">}</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onLocationChanged(Location location) {</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">currentLocation = location;</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(lastLocation != </code><code class="java keyword">null</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">&amp;&amp; geoPointFromLocation(location)</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.distanceInKilometersTo(geoPointFromLocation(lastLocation)) &lt; </code><code class="java value">0.01</code><code class="java plain">) {</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code><code class="java plain">;</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">lastLocation = location;</code></div><div class="line number25 index24 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number26 index25 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// Update the display</code></div><div class="line number27 index26 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>Our <code>onConnected</code> callback implementation saves the most recent location then kicks off a request for periodic updates. Our <code>onConnectionFailed</code> callback implementation tries to resolve the Location Services connection error. If it can't be resolved we call <code>showErrorDialog()</code> which displays an <code>ErrorDialogFragment</code> dialog to the user.</p>

<p>Our <code>onLocationChanged</code> callback implementation saves the location passed in then checks how much the location has changed. Parse provides a <code>distanceInKilometersTo(ParseGeoPoint point)</code> method on <code>ParseGeoPoint</code> to help us measure the change. We make use of the <code>lastLocation</code> field that stores the previous location reading. We convert both the current and the previous locations to <code>ParseGeoPoint</code>s then use <code>ParseGeoPoint.distanceInKilometersTo()</code> to make the comparison. We update our display if the change is more 10 meters.</p>

<p>The final step in tracking the user's location involves making sure we connect or disconnect the location client where appropriate:</p>

<div class="code parseTheme"><div><div id="highlighter_556707" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java color1">@Override</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onStop() {</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(locationClient.isConnected()) {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">stopPeriodicUpdates();</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">locationClient.disconnect();</code></div><div class="line number7 index6 alt2">&nbsp;</div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">.onStop();</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onStart() {</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">.onStart();</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">locationClient.connect();</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>We stop periodic location updates in <code>onStop()</code> and disconnect the location client. Conversely, we connect the location client in <code>onStart()</code> which eventually results in the start of periodic location updates when the location client is connected.</p>

<p><a name="6-configuring-settings"></a></p>

<h1>6. Remote Configuration</h1>

<p>Anywall users can customize the search radius distance they want to use. It would be nice to be able to customize the available options even after the app has shipped. Anywall also sets a 140 maximum character limit for new wall posts. Being able to customize this setting without an app refresh is also appealing. <a href="https://www.parse.com/docs/android_guide#config">Parse Config</a> provides a simple way to store app parameters on Parse that can be used to configure the app without requiring an app update. We will use this feature to remotely configure the search radius and maximum character limit.</p>

<p><a name="61-config-dashboard"></a></p>

<h2>6.1. Setting Up The Configuration Parameters</h2>

<p>The first step to using Parse Config is setting up the parameters we want to configure. These can be entered in the Parse Config Dashboard and they are simply key/value pairs. We will set up an <code>availableFilterDistances</code> parameter to hold an array of numbers representing the search radius options, and a <code>postMaxCharacterCount</code> parameter to hold a number representing the maximum character count for a new wall post.</p>

<p>Once we've set up these two parameters, we can access them from Anywall through the <code>ParseConfig</code> class.</p>

<p><a name="62-config-manager"></a></p>

<h2>6.2. ParseConfig Manager</h2>

<p>We begin by setting up a class called <code>ConfigHelper</code> to manage the app's configuration. It takes care of refreshing <code>ParseConfig</code> from Parse and providing access to the configuration parameters.</p>

<p>First, we'll set up a method to conditionally retrieve the latest <code>ParseConfig</code>:</p>

<div class="code parseTheme"><div><div id="highlighter_388389" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// ConfigHelper.java</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">fetchConfigIfNeeded() {</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java comments">// 1</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java keyword">long</code> <code class="java plain">configRefreshInterval = </code><code class="java value">60</code> <code class="java plain">* </code><code class="java value">60</code><code class="java plain">;</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(config == </code><code class="java keyword">null</code> <code class="java plain">||</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">System.currentTimeMillis() - configLastFetchedTime &gt; configRefreshInterval) {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 2</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">config = ParseConfig.getCurrentConfig();</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 3</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">ParseConfig.getInBackground(</code><code class="java keyword">new</code> <code class="java plain">ConfigCallback() {</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java color1">@Override</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">done(ParseConfig parseConfig, ParseException e) {</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(e == </code><code class="java keyword">null</code><code class="java plain">) {</code></div><div class="line number15 index14 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 4</code></div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">config = parseConfig;</code></div><div class="line number17 index16 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">configLastFetchedTime = System.currentTimeMillis();</code></div><div class="line number18 index17 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">} </code><code class="java keyword">else</code> <code class="java plain">{</code></div><div class="line number19 index18 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java comments">// 5</code></div><div class="line number20 index19 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">configLastFetchedTime = </code><code class="java value">0</code><code class="java plain">;</code></div><div class="line number21 index20 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number22 index21 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number23 index22 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">});</code></div><div class="line number24 index23 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number25 index24 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>Let's walk through this code step by step:</p>

<ol>
<li>We start a refresh of the configuration if more than an hour has passed since the last fetch or there's no currently saved configuration.</li>
<li>The last known <code>ParseConfig</code> is automatically cached locally by Parse. It's available by accessing <code>ParseConfig.getCurrentConfig()</code>. We set the private <code>config</code> variable to this value before we start the asynchronous configuration fetch.</li>
<li>We call <code>getInBackground</code> on <code>ParseConfig</code> to fetch the configuration in the background.</li>
<li>If the fetch completes successfully, the configuration is updated with the latest data and the last fetch time field is updated.</li>
<li>If the fetch fails, we reset the last fetch time to allow another fetch to happen the next time a configuration is requested.</li>
</ol>


<p>We'll want to access our <code>ConfigHelper</code> from anywhere in the application, so let's set this up in our application class. Also an ideal place to call our configuration manager's <code>fetchConfigIfNeeded</code> method is when our application is first created:</p>

<div class="code parseTheme"><div><div id="highlighter_679856" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// Application.java</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">private</code> <code class="java keyword">static</code> <code class="java plain">ConfigHelper configHelper;</code></div><div class="line number4 index3 alt1">&nbsp;</div><div class="line number5 index4 alt2"><code class="java color1">@Override</code></div><div class="line number6 index5 alt1"><code class="java keyword">public</code> <code class="java keyword">void</code> <code class="java plain">onCreate() {</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">configHelper = </code><code class="java keyword">new</code> <code class="java plain">ConfigHelper();</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">configHelper.fetchConfigIfNeeded();</code></div><div class="line number10 index9 alt1"><code class="java plain">}</code></div><div class="line number11 index10 alt2">&nbsp;</div><div class="line number12 index11 alt1"><code class="java keyword">public</code> <code class="java keyword">static</code> <code class="java plain">ConfigHelper getConfigHelper() {</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">configHelper;</code></div><div class="line number14 index13 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>In the code above, we've provided a static <code>getConfigHelper</code> method that provides access to our <code>ConfigHelper</code>. Other parts of the application can use this to gain access the configuration parameters of interest.</p>

<p>The application's <code>onCreate</code> is run when the application is created. We'll want to check for an updated configuration more often that that. Another good place to refresh the configuration would be when our main activity's view is displayed:</p>

<div class="code parseTheme"><div><div id="highlighter_898753" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// MainActivity.java</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java color1">@Override</code></div><div class="line number4 index3 alt1"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onResume() {</code></div><div class="line number5 index4 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">super</code><code class="java plain">.onResume();</code></div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Application.getConfigHelper().fetchConfigIfNeeded();</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number8 index7 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>Successive app launches shouldn't result in a new configuration being fetched unless more than an hour has passed.</p>

<p>Next, we will implement methods in <code>ConfigHelper</code> to access our configuration parameter values. Remember that <code>ParseConfig</code> returns a dictionary based on the parameters stored on Parse and this dictionary is stored in the <code>config</code> field. The search radius options can be retrieved by accessing the <code>availableFilterDistances</code> key:</p>

<div class="code parseTheme"><div><div id="highlighter_517476" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// ConfigHelper.java</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">public</code> <code class="java plain">List&lt;Float&gt; getSearchDistanceAvailableOptions() { </code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">final</code> <code class="java plain">List&lt;Float&gt; defaultOptions = Arrays.asList(</code><code class="java value">250</code><code class="java plain">.0f, </code><code class="java value">1000</code><code class="java plain">.0f, </code><code class="java value">2000</code><code class="java plain">.0f, </code><code class="java value">5000</code><code class="java plain">.0f);</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">List&lt;Number&gt; options = config.getList(</code><code class="java string">"availableFilterDistances"</code><code class="java plain">);</code></div><div class="line number7 index6 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(options == </code><code class="java keyword">null</code><code class="java plain">) { </code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">defaultOptions;</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">} </code></div><div class="line number10 index9 alt1">&nbsp;</div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">List&lt;Float&gt; typedOptions = </code><code class="java keyword">new</code> <code class="java plain">ArrayList&lt;Float&gt;();</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">for</code> <code class="java plain">(Number option : options) { </code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">typedOptions.add(option.floatValue());</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">} </code></div><div class="line number15 index14 alt2">&nbsp;</div><div class="line number16 index15 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">typedOptions;</code></div><div class="line number17 index16 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>If the <code>config</code> dictionary does not have the <code>availableFilterDistances</code> key, we return a default array of search radius options.</p>

<p>Similarly, we define a public method to access the maximum character count parameter which can be found via the <code>postMaxCharacterCount</code> key. A default value is returned if no data is found:</p>

<div class="code parseTheme"><div><div id="highlighter_255048" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java keyword">public</code> <code class="java keyword">int</code> <code class="java plain">getPostMaxCharacterCount () {</code></div><div class="line number2 index1 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">int</code> <code class="java plain">value = config.getInt(</code><code class="java string">"postMaxCharacterCount"</code><code class="java plain">, </code><code class="java value">140</code><code class="java plain">);</code></div><div class="line number3 index2 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">return</code> <code class="java plain">value;</code></div><div class="line number4 index3 alt1"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p><a name="63-using-config"></a></p>

<h2>6.3. Using the Configuration Data</h2>

<p>We have set up access to our <code>ConfigHelper</code> through our application class and added public methods to <code>ConfigHelper</code> to easily access the desired configuration data. We're ready for the last piece of the puzzle.</p>

<p>First, let's look at <code>SettingsActivity</code> that displays search radius options. The options are loaded in <code>onCreate</code>:</p>

<div class="code parseTheme"><div><div id="highlighter_430638" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// SettingsActivity.java</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">private</code> <code class="java plain">List&lt;Float&gt; availableOptions = Application.getConfigHelper()</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.getSearchDistanceAvailableOptions();</code></div><div class="line number5 index4 alt2">&nbsp;</div><div class="line number6 index5 alt1"><code class="java color1">@Override</code></div><div class="line number7 index6 alt2"><code class="java keyword">protected</code> <code class="java keyword">void</code> <code class="java plain">onCreate(Bundle savedInstanceState) {</code></div><div class="line number8 index7 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number9 index8 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">float</code> <code class="java plain">currentSearchDistance = Application.getSearchDistance();</code></div><div class="line number10 index9 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java keyword">if</code> <code class="java plain">(!availableOptions.contains(currentSearchDistance)) {</code></div><div class="line number11 index10 alt2"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">availableOptions.add(currentSearchDistance);</code></div><div class="line number12 index11 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">}</code></div><div class="line number13 index12 alt2"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">Collections.sort(availableOptions);</code></div><div class="line number14 index13 alt1"><code class="java spaces">&nbsp;&nbsp;</code><code class="java plain">...</code></div><div class="line number15 index14 alt2"><code class="java plain">}</code></div></div></td></tr></tbody></table></div></div></div>


<p>The <code>availableOptions</code> list is then used to build the search radius options. There is a default search radius that's added to the list if it wasn't returned from the Parse configuration.</p>

<p>Next up is <code>PostActivity</code>, that uses the maximum character count parameter:</p>

<div class="code parseTheme"><div><div id="highlighter_392983" class="syntaxhighlighter nogutter syntaxhighlighter java"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="java comments">// PostActivity.java</code></div><div class="line number2 index1 alt1">&nbsp;</div><div class="line number3 index2 alt2"><code class="java keyword">private</code> <code class="java keyword">int</code> <code class="java plain">maxCharacterCount = Application.getConfigHelper()</code></div><div class="line number4 index3 alt1"><code class="java spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="java plain">.getPostMaxCharacterCount();</code></div></div></td></tr></tbody></table></div></div></div>


<p>The <code>maxCharacterCount</code> value is then used to display the maximum count and validate the data entered.</p>

<p><a name="7-wrapping-up"></a></p>

<h1>7. Wrapping Up</h1>

<p>In this tutorial, we covered many key aspects of creating a social, location-aware app using Parse. We learned about <code>ParseUser</code> and it's role in user management by walking through the steps of registering, logging in, and keeping a user logged in. We learned how to create content using <code>ParseObject</code> and <code>ParseGeoPoint</code> to represent Anywall posts. We then covered how to display this content using <code>ParseQueryAdapter</code> for a list view representation and Google's <code>SupportMapFragment</code> for a map view representation. As we delved into the display logic, we learned how to use <code>ParseQuery</code> to retrieve content. We also used <code>ParseGeoPoint</code> to filter the query based on the user's current location and on the content's location information. We took a tour of the Google Maps API and saw how to use it to track the user's current location. We used this information to display the content on a map and to create new content. Finally, we saw how we could remotely manage Anywall's parameters. We used <code>ParseConfig</code> to manage the server fetch, made use of locally cached configuration data, and handled scenarios where there was no configuration data available.</p>

<p>If you're interested customizing this app to play around with the user interface or explore other Parse APIs, then grab the code from the link above, get creative and most importantly, have fun!</p>


</div>


	    
        </div>
    
        		<footer id="site-footer" class="" role="contentinfo">

			<div class="footer-content">

				<div class="quicklinks-group">
					<h3 class="small-header">Quicklinks</h3>
					<ul class="quicklinks-list">
						<li><a href="https://www.parse.com/products">Products</a></li>
						<li><a href="https://www.parse.com/platforms">Platforms</a></li>
						<li><a href="https://www.parse.com/plans">Pricing</a></li>
						<li><a href="https://www.parse.com/about">About</a></li>
						<li><a href="http://blog.parse.com/">Blog</a></li>
					</ul>
					<ul class="quicklinks-list">
						<li><a href="https://www.parse.com/help">Help</a></li>
						<li><a href="https://www.parse.com/docs">Docs</a></li>
						<li><a href="https://www.parse.com/docs/downloads">Download</a></li>
						<li><a href="https://status.parse.com/">Status</a></li>
						<li><a href="https://www.parse.com/about/policies">Policies</a></li>
					</ul>
				</div>

				<div class="support-socials">
					<h3 class="small-header">Need Help?</h3>
					<ul>
						<li><a href="https://www.parse.com/help">Get Support</a></li>
						<li><a href="https://groups.google.com/forum/#!forum/parse-developers" target="_blank">Developer Community</a></li>
						<li><a href="https://www.parse.com/tutorials">Tutorials</a></li>
					</ul>

					<h3 class="small-header">Stay Connected</h3>
					<p class="socials">
						<a href="https://www.facebook.com/parseit" target="_blank"><img src="./Anywall Android   Parse_files/facebook.svg"></a>
						<a href="https://twitter.com/parseit" target="_blank"><img src="./Anywall Android   Parse_files/twitter.svg"></a>
						<a href="https://github.com/ParsePlatform" target="_blank"><img src="./Anywall Android   Parse_files/github.svg"></a>
						<a href="http://stackoverflow.com/questions/tagged/parse.com" target="_blank"><img src="./Anywall Android   Parse_files/stackoverflow.svg"></a>
						<a href="https://groups.google.com/forum/#!forum/parse-developers" target="_blank"><img src="./Anywall Android   Parse_files/google.svg"></a>
					</p>
				</div>

				<div class="newsletter-cta">
					<div class="newsletter-cta-content">
						<h3 class="small-header">Get the Parse Newsletter</h3>
						<p class="copy-light">Be the first to know about new features, new platforms, upcoming events, and more!</p>
<div class="field-group inline-signup">
							<form action="https://www.parse.com/tutorials/anywall-android#" method="POST">
								<input class="input-text" type="text" name="footer_newsletter_signup" id="footer_newsletter_signup" placeholder="nancyshmancy@parse.com">
								<input type="submit" class="input-button footer" value="Sign Up">	
							</form>
						</div>
						<p class="copy-muted">We will never, ever spam you or sell your information. Promise.</p>
					</div>
				</div>

			</div>

			<div class="bottom-bar">
				<h4 class="small-header">Let's Build Together</h4>
			</div>

		</footer>



        
    <script id="7f187d702080c04292bf928afcc11d00" type="application/json">{&quot;company_name&quot;:&quot;&quot;,&quot;company_type&quot;:&quot;unknown&quot;,&quot;created_at&quot;:&quot;2015-05-18T09:34:51Z&quot;,&quot;email&quot;:&quot;kiamfestoh@gmail.com&quot;,&quot;id&quot;:479610,&quot;name&quot;:null,&quot;title&quot;:null,&quot;marketo_hash&quot;:&quot;5f73e968c888c60b697a2dd25531fe54d9c7a9ff&quot;,&quot;parse_apps_list&quot;:[{&quot;name&quot;:&quot;NaiEvents&quot;,&quot;id&quot;:&quot;naievents--2&quot;},{&quot;name&quot;:&quot;MyHouseHunterApp&quot;,&quot;id&quot;:&quot;myhousehunterapp&quot;},{&quot;name&quot;:&quot;HouseHunter&quot;,&quot;id&quot;:&quot;househunter--2&quot;},{&quot;name&quot;:&quot;my website&quot;,&quot;id&quot;:&quot;my-website--9&quot;},{&quot;name&quot;:&quot;myhomesearchapp&quot;,&quot;id&quot;:&quot;myhomesearchapp&quot;},{&quot;name&quot;:&quot;myandroidandrails&quot;,&quot;id&quot;:&quot;myandroidandrails&quot;},{&quot;name&quot;:&quot;mysite&quot;,&quot;id&quot;:&quot;mysite--19&quot;}],&quot;supported_platforms_list&quot;:{&quot;any&quot;:&quot;-&quot;,&quot;ios&quot;:&quot;iOS / OS X&quot;,&quot;android&quot;:&quot;Android&quot;,&quot;javascript&quot;:&quot;JavaScript&quot;,&quot;windows&quot;:&quot;Windows&quot;,&quot;dotnet&quot;:&quot;.NET&quot;,&quot;cloud_code&quot;:&quot;Cloud Code&quot;,&quot;rest&quot;:&quot;REST API&quot;,&quot;push&quot;:&quot;Push Notifications&quot;,&quot;xamarin&quot;:&quot;Xamarin&quot;,&quot;unity&quot;:&quot;Unity&quot;}}</script>
<script type="text/javascript">var user = JSON.parse(_.unescape($('#7f187d702080c04292bf928afcc11d00').html()));</script>

    <script type="text/javascript">
        App.currentUser = new App.Models.User(user);
    </script>

<script type="text/javascript">
  App.SessionRedirect.initialize();
</script>



  <script type="text/javascript">
    Marketo._devEnvironment = false;
    Marketo.associateLead();
  </script>

    <script type="text/javascript">
              new App.Views.Nagging.Banner().render();
$(document).on({
  ready: function() {
    var mns = new MarketoNewsletterSignup($);
    mns.init($('#site-footer input'));
  }
});
    // Disable all buttons on click
    $('form').submit(function(e) {
        $(this).find("button").attr("disabled", "disabled").addClass("disabled");
    });

    // Highlight all code blocks on the page if any are present
    SyntaxHighlighter.defaults['gutter'] = false;
    SyntaxHighlighter.defaults['toolbar'] = false;
    SyntaxHighlighter.defaults['class-name'] = "syntaxhighlighter";
    SyntaxHighlighter.all();

    // Custom template settings to escape javascript injected HTML by default (use - instead of = otherwise)
    _.templateSettings = {
      evaluate    : /<%([\s\S]+?)%>/g,
      escape : /<%=([\s\S]+?)%>/g,
      interpolate : /<%-([\s\S]+?)%>/g
    };

    // Intercept all push state links and use Parse.history to navigate instead of 
    // letting the browser change the page. 
    $(document).delegate("a[data-pushstate='true']", "click", function(e) {
      var href = $(e.currentTarget).attr('href'); // find url

      // disable in admin panel
      if (window.location.pathname.substring(0,6) === "/admin") {
        $(e.currentTarget).attr("href", "#" + $(e.currentTarget).attr("href"));
        return true;
      }

      // allow opening new tabs, windows, etc
      if (e.altKey || e.ctrlKey || e.metaKey || e.shiftKey || !Parse.history || !Parse.history._hasPushState) {
        return true;
      }

      Parse.history.navigate(href, { trigger: true });
      return false;
    });

    </script>

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-23813809-1']);
      _gaq.push(['_trackPageview']);
      
      (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
    
    <script type="text/javascript">
    if (typeof console == "object") {
      if (Util.is_chrome) {
        console.log("%cHey! Like what you see and enjoy looking under the hood? That's cool. We love curious people. You should join us and help us build great stuff. https://www.parse.com/jobs", "color: #0677c8; font-size: 18px; font-family: 'Helvetica-Neue', Helvetica, Arial, sans-serif;");
      } else {
        console.log("Hey! Like what you see and enjoy looking under the hood? That's cool. We love curious people. You should join us and help us build great stuff. https://www.parse.com/jobs");
      }
    }
    </script>


<script>
  _gaq.push([
    '_setCustomVar',
    1,             // This custom var is set to slot #1.
    'Logged In',   // The name of the custom variable.
    'true',
    2           // Sets the scope to session-level.
   ]);
</script>

  <script>
    _gaq.push([
      '_setCustomVar',
      2,          // Custom variable name
      'Company Type',
      "unknown",
      2           // Sets the scope to session-level.
    ]);
  </script>

<script type="text/javascript">
  var _kiq = _kiq || [];
  _kiq.push(['identify', "kiamfestoh@gmail.com"]);
</script>

<script type="text/javascript">
  (function() {
    window._pa = window._pa || {};
    var pa = document.createElement('script'); pa.type = 'text/javascript'; pa.async = true;
    pa.src = ('https:' == document.location.protocol ? 'https:' : 'http:') + "//tag.perfectaudience.com/serve/52373e831aa4c02794000069.js";
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(pa, s);
  })();
</script>

<!-- Google Tag Manager -->
<noscript>&lt;iframe src="//www.googletagmanager.com/ns.html?id=GTM-56BZ4D"
height="0" width="0" style="display:none;visibility:hidden"&gt;&lt;/iframe&gt;</noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-56BZ4D');</script>

<!-- Facebook Custom Audience Tracking Pixel -->
<script>(function() {
  var _fbq = window._fbq || (window._fbq = []);
  if (!_fbq.loaded) {
    var fbds = document.createElement('script');
    fbds.async = true;
    fbds.src = '//connect.facebook.net/en_US/fbds.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(fbds, s);
    _fbq.loaded = true;
  }
  _fbq.push(['addPixelId', '574561515946252']);
})();
window._fbq = window._fbq || [];
window._fbq.push(['track', 'PixelInitialized', {}]);
</script>
<noscript>&lt;img height="1" width="1" border="0" alt="" style="display:none" src="https://www.facebook.com/tr?id=574561515946252&amp;ev=NoScript" /&gt;</noscript>
    
    

<div id="cboxOverlay" style="display: none;"></div><div id="colorbox" class="" style="display: none;"><div id="cboxWrapper"><div><div id="cboxTopLeft" style="float: left;"></div><div id="cboxTopCenter" style="float: left;"></div><div id="cboxTopRight" style="float: left;"></div></div><div style="clear: left;"><div id="cboxMiddleLeft" style="float: left;"></div><div id="cboxContent" style="float: left;"><div id="cboxLoadedContent" style="width: 0px; height: 0px; overflow: hidden; float: left;"></div><div id="cboxLoadingOverlay" style="float: left;"></div><div id="cboxLoadingGraphic" style="float: left;"></div><div id="cboxTitle" style="float: left;"></div><div id="cboxCurrent" style="float: left;"></div><div id="cboxNext" style="float: left;"></div><div id="cboxPrevious" style="float: left;"></div><div id="cboxSlideshow" style="float: left;"></div><div id="cboxClose" style="float: left;"></div></div><div id="cboxMiddleRight" style="float: left;"></div></div><div style="clear: left;"><div id="cboxBottomLeft" style="float: left;"></div><div id="cboxBottomCenter" style="float: left;"></div><div id="cboxBottomRight" style="float: left;"></div></div></div><div style="position: absolute; width: 9999px; visibility: hidden; display: none;"></div></div></body></html>